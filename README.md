## RestChat

### Описание проекта

Данный проект создан в обучающих целях. Назначение - обучение простейшим навыкам проектирования, командной работы над проектом. Тренировка навыков программирования. Использования тестового окружения с применением контейнеризации.

Приложение представляет собой клиент-серверное приложение "веб-чат" с простейшими функциями регистрации, авторизации, отправки и приема сообщений, вывода списка онлайн участников.

Взаимодействие между клиентом и сервером производится посредством RESTFUL HTTP API.

### Технологический стек

![Go](https://img.shields.io/badge/go-%2300ADD8.svg?style=for-the-badge&logo=go&logoColor=white) ![HTML5](https://img.shields.io/badge/html5-%23E34F26.svg?style=for-the-badge&logo=html5&logoColor=white) ![Bootstrap](https://img.shields.io/badge/bootstrap-%23563D7C.svg?style=for-the-badge&logo=bootstrap&logoColor=white) ![JavaScript](https://img.shields.io/badge/javascript-%23323330.svg?style=for-the-badge&logo=javascript&logoColor=%23F7DF1E) ![React](https://img.shields.io/badge/react-%2320232a.svg?style=for-the-badge&logo=react&logoColor=%2361DAFB)  ![Docker](https://img.shields.io/badge/docker-%230db7ed.svg?style=for-the-badge&logo=docker&logoColor=white) ![Nginx](https://img.shields.io/badge/nginx-%23009639.svg?style=for-the-badge&logo=nginx&logoColor=white) ![Git](https://img.shields.io/badge/git-%23F05033.svg?style=for-the-badge&logo=git&logoColor=white) ![GitHub](https://img.shields.io/badge/github-%23121011.svg?style=for-the-badge&logo=github&logoColor=white)

### Функциональные требования

- Регистрация (register)
- Авторизация (login)
- Один пользователь - одна сессия
- Отображение списка онлайн пользователей
- Отображение списка последних N сообщений
- Автоматическое обновление списка пользователей
- Автоматическое обновление сообщений
- Отправка сообщения
- Деавторизация (logout)
- Ограничения формата пользователя
- Ограничения формата сообщения

### Архитектурные требования

- Клиент-серверная архитектура
- REST api
- Формат данных между клиентом и сервером JSON
- Бэкенд - веб-сервер на Golang
- Фронтенд - SPA на React.js
- Контейнеризация (Docker, Docker-compose) тестовой среды
- ? Интеграционные end to end тесты (selenium)
- ? CI/CD

### Макеты страниц

#### Страница авторизации

![img](./images/restchat_client_layout_1.svg)

- MessageBox - опциональное поле сообщений об ошибках
- login, password - текстовые поля ввода логина/пароля (общие для логина и регистрации)
- Login - кнопка запроса авторизации
- Register - кнопка запроса регистрации

#### Главное окно чата

![img](./images/restchat_client_layout_2.svg)

- (левая панель) - панель со списком онлайн участников чата
- (правая панель) - панель сообщений чата (последние внизу)
- Logout - кнопка деавторизации (выход из чата)
- Message - текстовое поле для отправки сообщения (отправка по нажатию Enter)

### REST API

---

#### **Форматы данных и ограничения**

Формат даты и времени: ISO 8601, часовой пояс UTC

Пример:

```json
{time: "2022-02-04T08:02:56Z"}
```

Максимальная длина логина: 16 символов.

Разрешенные символы для логина: [a-zA-Z0-9_].

Максимальная длина пароля: 32 символа.

Максимальная длина сообщения: 1024 символа.

---

#### **Общая ошибка формата запроса от клиента**

Общая ошибка для наименования или количества полей в json запросе от клиента. Например, запрос на авторизацию обязательно должен содержать поля username и password, ошибка выдается в случае нарушения данных требований.

**Код ошибки**:

```http
400 Bad Request
```

**Тело сообщения**:

```json
{error: "error_message"}
```

---

#### **POST /api/login**

**Описание**: Авторизация с помощью логина и пароля. В случае успеха сервер возвращает токен авторизации и информацию о пользователе (участнике чата). После авторизации создается новая сессия и пользователь считается онлайн до момента деавторизации (удаления сессии). Если ранее у пользователя была создана активная сессия, то она удаляется и заменяется новой (старый пользователь деавторизован).

**Данные запроса**:

```json
{username: "string", password: "string"}
```

**Успешная авторизация**:

```http
200 OK
```

```json
{auth_token: "string", member: {id: 12, name: "vasya"}}
```

**Ошибка - Неправильный логин/пароль**:

```http
401 Unauthorized
```

```json
{error: "error_message"}
```

---

#### **POST /api/user**

**Описание**: Создание нового пользователя (регистрация) с заданным паролем. В случае успеха клиенту возвращается обратно имя созданного пользователя.

**Данные запроса**:

```json
{username: "string", password: "string"}
```

**Пользователь успешно создан**:

```http
201 Created
```

```json
{username: "string"}
```

**Ошибка 1 - Пользователь уже существует**:

```http
403 Forbidden
```

```json
{error: "error_message"}
```

**Ошибка 2 - Неправильный формат логина/пароля**:

```http
400 Bad Request
```

```json
{error: "error_message"}
```

---

#### **POST /api/logout**

**Описание**: Деавторизация пользователя (выход из чата, закрытие, удаление текущей сессии). После деавторизации пользователь больше не считается онлайн.

**Данные запроса**:

```json
{api_token: "string"}
```

**Пользователь успешно деавторизован**:

```http
200 OK
```

```json
{}
```

**Ошибка - Неправильный токен**:

```http
400 Bad Request
```

```json
{error: "error_message"}
```

---

#### **GET /api/members**

**Описание**: Получения списка участников чата (онлайн пользователей, авторизованных). Список передается только авторизованным пользователям, корректно предъявившим токен авторизации.

**Данные запроса**:

```json
{api_token: "string"}
```

**Успешно получен список онлайн участников чата**:

```http
200 OK
```

```json
{
	members: [
		{id: 12, name: "vasya"},
		{id: 14, name: "petya"},
	]
}
```
Успех, но в случае пустого списка пользователей:

```http
200 OK
```

```json
{members: []}
```

**Ошибка - Неправильный токен авторизации**:

```http
400 Bad Request
```

```json
{error: "error_message"}
```

---

#### **GET /api/messages**

**Описание**: Получения полного списка последних сообщений в чате. Доступен только для авторизованных пользователей, предъявивших корректный токен авторизации.

**Данные запроса**:

```json
{api_token: "string"}
```

**Успешное получение списка последних сообщений**:

```http
200 OK
```

```json
{
	messages: [
		{id: 1002, member_name: "petya", text: "hello", time: "2022-02-04T13:28:77Z"},
		{id: 1001, member_name: "vasya", text: "hello", time: "2022-02-04T13:23:77Z"},
	]
}
```

Либо в случае отсутствия сообщений, пустой список сообщений:

```http
200 OK
```

```json
{messages: []}
```

**Ошибка - Неправильный токен авторизации**:

```http
400 Bad Request
```

```json
{error: "error_message"}
```

---

#### **POST /api/message**

**Описание**: Отправка (создание) нового сообщения. Доступна только авторизованным пользователям. Клиент обязан передать токен авторизации и текст сообщения. В случае успеха клиенту возвращаются данные созданного сообщения. Текст сообщения не может быть пустым.

**Данные запроса**:

```json
{api_token: "string", text: "string"}
```

**Сообщение успешно создано**:

```http
200 OK
```

```json
{
	message: {
        id: 1002,
        member_name: "petya",
	    text: "hello",
	    time: "2022-02-04T13:28:77Z"
	}
}
```

**Ошибка 1 - Неправильный токен**:

```http
400 Bad Request
```

```json
{error: "error_message"}
```

**Ошибка 2 - Пустое сообщение**:

```http
400 Bad Request
```

```json
{error: "error_message"}
```

---